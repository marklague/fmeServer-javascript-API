!function(e,a,t,o){"use strict";var r,n,i,s,l="wb-geomap",p="."+l,d=o.doc,m=2e3,c=0,g=[],u={config:{controls:[],autoUpdateSize:!0,fractionalZoom:!0,theme:null},overlays:[],features:[],tables:[],useScaleLine:!1,useMousePosition:!1,useLegend:!1,useTab:!1,useMapControls:!0,useGeocoder:!1,useGeolocation:!1,useAOI:!1},y=function(r){var p,d,m=r.target,c=m.className,g={};r.currentTarget===m&&(p=e(m),s||(i=o.i18n,s={add:i("add"),close:i("close"),colon:i("colon"),hiddenLayer:i("geo-hdnlyr"),toggleLayer:i("geo-tgllyr"),labelSelect:i("geo-lblsel"),select:i("geo-sel"),zoomFeature:i("geo-zmfeat"),zoomin:i("geo-zmin"),zoomout:i("geo-zmout"),zoomworld:i("geo-zmwrld"),baseMapTitle:i("geo-bmapttl"),baseMapURL:i("geo-bmapurl"),baseMapURLTxt:i("geo-bmapurltxt"),scaleline:i("geo-sclln"),mouseposition:i("geo-msepos"),access:i("geo-ally"),accessTitle:i("geo-allyttl"),attribLink:i("geo-attrlnk"),attribTitle:i("geo-attrttl"),ariaMap:i("geo-ariamap"),geoLocationURL:i("geo-locurl-geogratis"),geoCoderPlaceholder:i("geo-loc-placeholder"),geoCoderLabel:i("geo-loc-label"),aoiNorth:i("geo-aoi-north"),aoiEast:i("geo-aoi-east"),aoiSouth:i("geo-aoi-south"),aoiWest:i("geo-aoi-west"),aoiInstructions:i("geo-aoi-instructions"),aoiBtnDraw:i("geo-aoi-btndraw"),aoiBtnClear:i("geo-aoi-btnclear"),aoiBtnClose:i("close"),geolocBtn:i("geo-geoloc-btn"),geolocFail:i("geo-geoloc-fail"),geolocUncapable:i("geo-geoloc-uncapable"),geoLgndGrphc:i("geo-lgnd-grphc")}),d={useScaleLine:-1!==c.indexOf("scaleline")?!0:void 0,useMousePosition:-1!==c.indexOf("position")?!0:void 0,useLegend:-1!==c.indexOf("legend"),useTab:-1!==c.indexOf("tab"),useMapControls:-1!==c.indexOf("static")?!1:!0,useGeocoder:-1!==c.indexOf("geocoder")?!0:!1,useGeolocation:-1!==c.indexOf("geolocation")?!0:!1,useAOI:-1!==c.indexOf("aoi")?!0:!1},e.extend(g,u,d,a[l],o.getData(p,l)),p.data({settings:g}),a.Proj4js={Proj:function(e){var t=proj4(a.Proj4js.defs[e]);return t.srsCode=e,t},defs:proj4.defs,transform:proj4},OpenLayers.Lang.setCode(t.documentElement.lang),OpenLayers.ImgPath=o.getPath("/assets")+"/",proj4.defs("EPSG:3978","+proj=lcc +lat_1=49 +lat_2=77 +lat_0=49 +lon_0=-95 +x_0=0 +y_0=0 +ellps=GRS80 +datum=NAD83 +units=m +no_defs"),n=b(p),n.aoiToggle="undefined"!=typeof g.aoi&&"undefined"!=typeof g.aoi.toggle?g.aoi.toggle:!0,n.aoiExtent="undefined"!=typeof g.aoi&&"undefined"!=typeof g.aoi.extent?g.aoi.extent:null,g.layersFile?e.ajax({url:g.layersFile,dataType:"script",async:!1,success:function(){e.extend(g,wet_boew_geomap),q(n,g)}}):q(n,g),n.overlays||ee(n))},b=function(e){var a={mapid:e.attr("id"),map:null,selectControl:null,showAttribNRCan:!1,queryLayers:[],overlays:0,overlaysLoaded:0,overlaysLoading:{}},t=e.find(".wb-geomap-map");return a.gmap=t.attr("id","geomap-map-"+a.mapid).height(.8*t.width()),a.glegend=e.find(".wb-geomap-legend").attr("id","geomap-legend-"+a.mapid),a.glayers=e.find(".wb-geomap-layers").attr("id","geomap-layers-"+a.mapid),a},f=function(e){var a=new OpenLayers.Control.PanZoom;OpenLayers.Util.extend(a,{draw:function(){var e,a=this,t=["zoomin","zoomout","zoomworld"],o=["zoom-plus-mini","zoom-minus-mini","zoom-world-mini"],r=t.length;for(OpenLayers.Control.prototype.draw.apply(a,arguments),a.buttons=[],e=0;e!==r;e+=1)a._addButton(t[e],o[e]+".png");return a.div}}),e.map.addControl(a),L(e)},L=function(e){var a,t,o,r,n,i=e.gmap.find(".olControlPanZoom")[0],l=i.getElementsByTagName("div"),p=l.length;for(i.setAttribute("role","toolbar"),a=0;a!==p;a+=1)t=l[a],o=t.getElementsByTagName("img")[0],o&&(n=t.action,r=s[n],t.setAttribute("aria-label",r),t.setAttribute("title",r),t.setAttribute("role","button"),t.className+=" olControl"+n,t.tabIndex=0,o.setAttribute("alt",r),o.className+=" olControl"+n)},v=function(a){var t=a.id.replace(/\W/g,"_");e("#"+t).addClass("active"),e("#cb_"+t).prop("checked",!0)},h=function(a){var t=a.id.replace(/\W/g,"_"),o=a.popup;e("#"+t).removeClass("active"),e("#cb_"+t).prop("checked",!1),o&&o.visible()&&o.hide()},w=function(e){var a=e.layer.map.getControlsByClass("OpenLayers.Control.SelectFeature")[0];e._lastHighlighter?a.unselect(e):(a.select(e),e.layer.popups&&(r&&r.popup&&r.popup.visible()&&r.popup.hide(),e.popup?e.popup.toggle():O(e)))},O=function(e){var a,o,r,i,l,p,d,m,c,g,u,y=e.layer.popupsInfo,b=e.id.replace(/\W/g,"_"),f=s.close,L=s.colon,v=e.layer.map.size,h="<h3>"+t.getElementById(e.layer.name).getAttribute("aria-label")+"</h3>";if(y){c=y.id,g=y.width,u=y.height,a=(c?c:"popup_")+"_"+b,o=u?u:v.h/2,r=g?g:v.w/2,i=g?y.close:!0,h+=y.content;for(l in e.attributes)e.attributes.hasOwnProperty(l)&&0!==l.length&&(m=new RegExp("_"+l,"igm"),h=h.replace(m,e.attributes[l]))}else{a="popup_"+b,o=v.h/2,r=v.w/2,i=!0;for(l in e.attributes)e.attributes.hasOwnProperty(l)&&0!==l.length&&(h+="<p><strong>"+l+L+"</strong><br />"+e.attributes[l]+"</p>")}p=new OpenLayers.Popup.FramedCloud(a,e.geometry.getBounds().getCenterLonLat(),new OpenLayers.Size(r,o),h,null,i,null),p.maxSize=new OpenLayers.Size(r,o),e.popup=p,e.layer.map.addPopup(p),d=t.createElement("span"),d.className="glyphicon glyphicon-remove-circle close_"+b,d.setAttribute("data-map",n.mapid),d.setAttribute("data-layer",e.layer.id),d.setAttribute("data-feature",e.id),d.setAttribute("aria-label",f),d.setAttribute("title",f),d.setAttribute("role","button"),d.setAttribute("tabindex","0"),e.popup.closeDiv.appendChild(d)},x=function(e,a){if(a){var t=e.glayers.find(".wb-geomap-tabs");0!==t.length?t.attr({"class":"wb-tabs auto-height-none",id:"geomap-tabs-"+e.mapid}):e.glayers.prepend("<div id='geomap-tabs-"+e.mapid+"' class='wb-geomap-tabs wb-tabs auto-height-none' style='width: "+e.glayers.width()+"px;'>")}},C=function(a,t,o,r){return e("<table class='table "+(r?" wb-tables":" table-condensed")+"' aria-label='"+t+"' id='overlay_"+a+"'><caption>"+o+"</caption><thead></thead><tbody></tbody></table>")},P=function(a,t,o,r,n){0!==a.glegend.length&&S(a,t,o,r);var i=a.glayers,l=e("<div class='wb-geomap-table-wrapper'></div>"),p=t[0].id,d=e("<div id='tabs_"+p+"'>"),m=t[0].attributes["aria-label"].value,c=e("<h3>"+m+"</h3>"),g=e("<div id='msg_"+p+"'><p>"+s.hiddenLayer+"</p></div>");n&&0!==e(".wb-geomap-tabs").length?T(a,t,o,r):(d.append(c,l.append(t)),i.append("<div class='col-md-12'>"+d.html()+"</div>")),o||(d.append(g),l.hide())},S=function(a,t,o,r){var n,i,l,p,d,m,c=e(t),g=t[0].id,u=a.glegend;a.glegend&&(n=u.find("fieldset"),0===n.length&&(n=u.append("<fieldset name='legend'><legend class='wb-inv'>"+s.toggleLayer+"</legend></fieldset>")),l=o?"checked='checked'":"",i=u.find("ul"),0===i.length&&(i=e("<ul class='list-unstyled'></ul>").appendTo(n)),p=e("<input type='checkbox' id='cb_"+g+"' class='geomap-lgnd-cbx' value='"+g+"' "+l+" data-map='"+a.mapid+"' data-layer='"+r+"' />"),d=e("<label>",{"for":"cb_"+g,text:c.attr("aria-label")}).prepend(p),m=e("<li class='checkbox geomap-lgnd-layer'>").append(d,"<div id='sb_"+g+"'></div>"),i.append(m),e("#sb_"+g).toggle(o))},G=function(a){var t,o,r,n,i,l,p,d,m,c,g,u,y,b,f=a.map.layers.length,L=s.colon,v=[];for(g=0;g!==f;g+=1)if(i=a.map.layers[g],i.isBaseLayer||"OpenLayers.Layer.WMS"===i.CLASS_NAME)"OpenLayers.Layer.WMS"===i.CLASS_NAME&&(i.legendUrl?e("#sb_"+i.name).append("<img src='"+i.legendUrl+"' alt='"+s.geoLgndGrphc+"'/>"):i.legendHTML&&e("#sb_"+i.name).append(i.legendHTML));else if(o=e("#sb_"+i.name),n="",o.length)if(l=i.styleMap.styles["default"],p=l.defaultStyle,t=l.rules.length){for(r="<ul class='list-unstyled'>",u=0;u!==t;u+=1)y=l.rules[u],d=y.filter,m=d.type,"=="===m&&(m=L),c=y.symbolizer,b="ls_"+i.name+"_"+u,r+="<li><div class='row'><div id='"+b+"' class='col-md-2 geomap-legend-symbol'></div><div class='col-md-10'><small>"+d.property+" "+(null!==d.value?m+" "+d.value:d.lowerBoundary+" "+m+" "+d.upperBoundary)+"</small></div></div></li>",v.push({id:b,feature:i.features[0],symbolizer:c});o.append(r)}else v.push({id:"sb_"+i.name,feature:i.features[0],symbolizer:p});F(v)},F=function(e){var a,t,o=e.length;for(a=0,o;a!==o;a+=1)t=e[a],E(t.id,t.feature,t.symbolizer)},E=function(e,a,t){var o,r,n,i,s,l=a&&a.geometry?a.geometry.CLASS_NAME:"OpenLayers.Geometry.Polygon",p=20,d=t.strokeWidth?t.strokeWidth:0,m=["SVG","VML","Canvas"],c=20;for(i=0,s=m.length;i!==s;i+=1)if(r=OpenLayers.Renderer[m[i]],r&&r.prototype.supported()){n=new r(e,null);break}switch(n.map={resolution:1,getResolution:function(){return this.resolution}},l){case"OpenLayers.Geometry.Polygon":o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(2,2),new OpenLayers.Geometry.Point(2,18),new OpenLayers.Geometry.Point(18,18),new OpenLayers.Geometry.Point(18,2),new OpenLayers.Geometry.Point(2,2)])]));break;case"OpenLayers.Geometry.Point":p=t.graphicHeight?t.graphicHeight:t.pointRadius?2*t.pointRadius+2*d:20,c=t.graphicWidth?t.graphicWidth:t.pointRadius?2*t.pointRadius+2*d:20,o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(c/2,p/2));break;case"OpenLayers.Geometry.LineString":o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([new OpenLayers.Geometry.Point(2,18),new OpenLayers.Geometry.Point(6,2),new OpenLayers.Geometry.Point(12,18),new OpenLayers.Geometry.Point(18,2)]));break;default:o=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(2,2),new OpenLayers.Geometry.Point(2,18),new OpenLayers.Geometry.Point(18,18),new OpenLayers.Geometry.Point(18,2),new OpenLayers.Geometry.Point(2,2)])]))}n.setSize(new OpenLayers.Size(c,p)),n.resolution=1,n.setExtent(new OpenLayers.Bounds(0,0,c,p),!0),n.clear(),n.drawFeature(o,t)},T=function(a,t,o){var r,n=a.glayers.find(".wb-geomap-tabs"),i=n.find("ul"),l=t[0].id,p=e("<div class='wb-geomap-table-wrapper'></div>").append(t),d=t.attr("aria-label");r=e("<details>",{id:"details-"+l}).append("<summary>"+d+"</summary>",p),i.append("<li><a href='#tabs_"+l+"'>"+d+"</a></li>"),n.append(r),o||(r.append("<div id='msg_"+l+"'><p>"+s.hiddenLayer+"</p></div>"),p.hide())},j=function(e){var a,t,r,n,i,s,l,p,d,m,g,u,y=o.drawColours[c],b=y,f={strokeColor:y,fillColor:b,fillOpacity:.5,pointRadius:5,strokeWidth:.5},L={strokeColor:"#00f",fillColor:"#00f",fillOpacity:.4,strokeWidth:2},v=e.style;if(c+=1,c===o.drawColours.length&&(c=0),v)if(p=v.type,g=v.select,d={select:new OpenLayers.Style(g?g:L)},"rule"===p){for(r=[],l=new OpenLayers.Style,m=v.rule,s=m.length,i=0;i!==s;i+=1)n=m[i],u=n.filter,t={type:OpenLayers.Filter.Comparison[u],property:n.field},"BETWEEN"!==u?t.value=n.value[0]:(t.lowerBoundary=n.value[0],t.upperBoundary=n.value[1]),r.push(new OpenLayers.Rule({filter:new OpenLayers.Filter.Comparison(t),symbolizer:n.init}));l.addRules(r),d["default"]=l}else"unique"!==p&&(d["default"]=new OpenLayers.Style(v.init));else d={"default":new OpenLayers.Style(f),select:new OpenLayers.Style(L)};return a=new OpenLayers.StyleMap(d),v&&"unique"===p&&a.addUniqueValueRules("default",v.field,v.init),a},M=function(e,a,t,o){var r,n,i=a.feature,l=i.attributes,p="head"===a.type,d=i.id.replace(/\W/g,"_");r=p?"<tr><th>"+s.select+"</th>":"<tr id='featureId'>"+z(e,i,d);for(n in l)l.hasOwnProperty(n)&&(r+=p?"<th>"+n+"</th>":"<td>"+l[n]+"</td>");return t&&(p?o&&(r+="<th>"+s.zoomFeature+"</th>"):r+=R(e,a.feature)),r+"</tr>"},A=function(a,r,n,i,s,l){var p,d,m={type:"head",feature:n.features[0]},c=t.getElementById(r.attr("id")),g=c.getElementsByTagName("thead")[0],u=c.getElementsByTagName("tbody")[0],y=a.selectControl,b=n.features,f=b.length,L=/\W/g,v=M(a,m,i,l),h=u.innerHTML;for(d=0;d!==f;d+=1)p=b[d],h+=M(a,{type:"body",id:p.id.replace(L,"_"),feature:p,selectControl:y},i,l);o.ielt9?(e(g).html(v),e(u).html(h)):(e(g).html(v),e(u).html(h))},B=function(e){e.gmap.find(".olTileImage").attr("alt",""),e.overlaysLoaded+=1,e.overlays===e.overlaysLoaded&&(ee(e),e.overlays=0,e.overlaysLoaded=0)},_=function(a,r,n,i){var s=r.id.replace(/\W/g,"_"),l=t.getElementById(s),p=z(a,r,s)+l.innerHTML+(i&&n?R(a,r):"");o.ielt9?e(l).html(p):e(l).html(p)},z=function(e,a,t){return"<td><label class='wb-inv' for='cb_"+t+"'>"+s.labelSelect+"</label><input type='checkbox' id='cb_"+t+"' class='geomap-cbx' data-map='"+e.mapid+"' data-layer='"+a.layer.id+"' data-feature='"+a.id+"' /></td>"},R=function(e,a){return"<td><a href='javascript:;' data-map='"+e.mapid+"' data-layer='"+a.layer.id+"' data-feature='"+a.id+"' class='btn btn-default btn-sm geomap-zoomto'>"+s.zoomFeature+"</a></td>"},k=function(e){var a,t=e.gmap.width(),o={name:s.baseMapTitle,url:s.baseMapURL,layer:s.baseMapTitle,matrixSet:"nativeTileMatrixSet",tileSize:new OpenLayers.Size(256,256),format:"image/jpg",style:"default",requestEncoding:"REST",isBaseLayer:!0,isSingleTile:!1,tileOrigin:new OpenLayers.LonLat(-34655800,3931e4),zoomOffset:5,resolutions:[38364.660062653464,22489.62831258996,13229.193125052918,7937.5158750317505,4630.2175937685215,2645.8386250105837,1587.5031750063501,926.0435187537042,529.1677250021168,317.50063500127004,185.20870375074085,111.12522225044451,66.1459656252646,38.36466006265346,22.48962831258996,13.229193125052918,7.9375158750317505,4.6302175937685215],transitionEffect:"resize"};for(t>260&&500>=t?o.zoomOffset=1:t>500&&725>=t?o.zoomOffset=2:t>725&&1175>=t?o.zoomOffset=3:t>1175&&2300>=t&&(o.zoomOffset=4),a=o.zoomOffset-1;-1!==a;a-=1)o.resolutions.shift();e.map.addLayer(new OpenLayers.Layer.WMTS(o)),o.url=s.baseMapURLTxt,o.isBaseLayer=!1,delete o.transitionEffect,e.map.addLayer(new OpenLayers.Layer.WMTS(o))},I=function(){var e={maxExtent:new OpenLayers.Bounds(-275e4,-9e5,36e5,463e4),restrictedExtent:new OpenLayers.Bounds(-285e4,-1e6,37e5,473e4),maxResolution:"auto",projection:"EPSG:3978",units:"m",displayProjection:new OpenLayers.Projection("EPSG:4269"),aspectRatio:.8,fractionalZoom:!1,tileManager:null};return e},N=function(a,t){var o,r,n,i,s=t.basemap,l=s&&0!==s.length;if(l)if(r=s.mapOptions)try{o={maxExtent:new OpenLayers.Bounds(r.maxExtent.split(",")),restrictedExtent:new OpenLayers.Bounds(r.restrictedExtent.split(",")),maxResolution:r.maxResolution,projection:new OpenLayers.Projection(r.projection),units:r.units,displayProjection:new OpenLayers.Projection(r.displayProjection),numZoomLevels:r.numZoomLevels,aspectRatio:r.aspectRatio,fractionalZoom:r.fractionalZoom,tileManager:null}}catch(p){o={projection:new OpenLayers.Projection("EPSG:4326")}}else o={projection:new OpenLayers.Projection("EPSG:4326")};else o=I();n=void 0===o.aspectRatio?.8:o.aspectRatio,a.gmap.height(a.gmap.width()*o.aspectRatio),a.map=new OpenLayers.Map(a.gmap.attr("id"),e.extend(t.config,o)),a.map.controls=[],l?"wms"===s.type?(i=W(s),a.map.addLayer(new OpenLayers.Layer.WMS(s.title,s.url,i,{isBaseLayer:!0}))):"esri"===s.type&&a.map.addLayer(new OpenLayers.Layer.ArcGIS93Rest(s.title,s.url)):(k(a),a.showAttribNRCan=!0)},W=function(e){var a,t={};for(a in e)e.hasOwnProperty(a)&&"type"!==a&&"caption"!==a&&"url"!==a&&"title"!==a&&(t[a]=e[a]);return t},V=function(t,r){var n,i=r.overlays,s=i.length;0!==s&&(t.overlays=s,e.each(i,function(s,l){var p,d=l.type,c=l.title,g=l.visible,u=l.url,y=C(s,c,l.caption,l.datatable);"wms"===d?(p=W(l),n=new OpenLayers.Layer.WMS(c,u,p,l.options),n.name="overlay_"+s,n.datatable=!1,n.popupsInfo=!1,n.popups=!1,n.legendUrl=l.options?l.options.legendGraphicUrl:null,n.legendHTML=l.options?l.options.legendHTML:null,t.map.addLayer(n),S(t,y,g,n.id),n.visibility=g):"kml"===d?(n=new OpenLayers.Layer.Vector(c,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:u,format:new OpenLayers.Format.KML({extractStyles:!l.style,extractAttributes:!0,internalProjection:t.map.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4269"),read:function(t){var r,n,i,s,p,d,m,c,g=0,u=[],y=l.attributes;for("string"==typeof t&&(o.ie?(m=new a.ActiveXObject("Microsoft.XMLDOM"),m.async=!1,m.loadXML(t),t=m):t=(new DOMParser).parseFromString(t,"text/xml")),r=this.getElementsByTagNameNS(t,"*","Placemark"),s=r.length;g!==s;g+=1){n=r[g],i=e(n),p=new OpenLayers.Feature.Vector,p.geometry=this.parseFeature(n).geometry,d={};for(c in y)y.hasOwnProperty(c)&&(d[y[c]]=i.find(c).text());p.attributes=d,u.push(p)}return u}})}),eventListeners:{featuresadded:function(e){A(t,y,e,l.zoom,l.datatable,r.useMapControls),t.overlaysLoading[c]&&B(t)},loadstart:function(){t.overlaysLoading[c]=!0,setTimeout(function(){t.overlaysLoading[c]&&B(t)},m)}},styleMap:j(i[s])}),n.name="overlay_"+s,n.datatable=l.datatable,n.popupsInfo=l.popupsInfo,n.popups=l.popups,n.visibility=!0,t.queryLayers.push(n),t.map.addLayer(n),P(t,y,g,n.id,l.tab),n.visibility=g):"atom"===d?(n=new OpenLayers.Layer.Vector(c,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:u,format:new OpenLayers.Format.Atom({read:function(a){var o,r,n,i,s,p,d,m,c,g,u,y,b,f=this.getElementsByTagNameNS(a,"*","entry"),L=[],v=l.attributes,h=new OpenLayers.Projection("EPSG:4326"),w=t.map.getProjectionObject();for(n=0,i=f.length;n!==i;n+=1){o=f[n],r=e(o),b=this.parseFeature(o),s=new OpenLayers.Feature.Vector,u=b.geometry.components[0],"OpenLayers.Geometry.Polygon"===b.geometry.CLASS_NAME&&5===u.components.length?(d=U(u.components[1].x,u.components[1].y,u.components[3].x,u.components[3].y),m=new OpenLayers.Geometry.LinearRing(d),c=new OpenLayers.Geometry.Polygon(m),g=c.transform(h,w),s.geometry=g):s.geometry=this.parseFeature(o).geometry.transform(h,w),p={};for(y in v)v.hasOwnProperty(y)&&(p[v[y]]=r.find(y).text());s.attributes=p,L.push(s)}return L}})}),eventListeners:{featuresadded:function(e){A(t,y,e,l.zoom,l.datatable,r.useMapControls),t.overlaysLoading[c]&&B(t)},loadstart:function(){t.overlaysLoading[c]=!0,setTimeout(function(){t.overlaysLoading[c]&&B(t)},m)}},styleMap:j(i[s])}),n.name="overlay_"+s,n.datatable=l.datatable,n.popupsInfo=l.popupsInfo,n.popups=l.popups,n.visibility=!0,t.queryLayers.push(n),t.map.addLayer(n),P(t,y,g,n.id,l.tab),n.visibility=g):"georss"===d?(n=new OpenLayers.Layer.Vector(c,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.HTTP({url:u,format:new OpenLayers.Format.GeoRSS({read:function(a){var o,r,n,i,s,p,d,m,c,g,u,y,b,f=this.getElementsByTagNameNS(a,"*","item"),L=[],v=l.attributes,h=new OpenLayers.Projection("EPSG:4326"),w=t.map.getProjectionObject();for(n=0,i=f.length;n!==i;n+=1){o=f[n],r=e(o),b=this.createFeatureFromItem(o),c=new OpenLayers.Feature.Vector,u=b.geometry.components[0],"OpenLayers.Geometry.Polygon"===b.geometry.CLASS_NAME&&5===u.components.length?(s=U(u.components[1].x,u.components[1].y,u.components[3].x,u.components[3].y),p=new OpenLayers.Geometry.LinearRing(s),d=new OpenLayers.Geometry.Polygon(p),m=d.transform(h,w),c.geometry=m):c.geometry=this.parseFeature(o).geometry.transform(h,w),g={};for(y in v)v.hasOwnProperty(y)&&(g[v[y]]=r.find(y).text());c.attributes=g,L.push(c)}return L}})}),eventListeners:{featuresadded:function(e){A(t,y,e,l.zoom,l.datatable,r.useMapControls),t.overlaysLoading[c]&&B(t)},loadstart:function(){t.overlaysLoading[c]=!0,setTimeout(function(){t.overlaysLoading[c]&&B(t)},m)}},styleMap:j(i[s])}),n.name="overlay_"+s,n.datatable=l.datatable,n.popupsInfo=l.popupsInfo,n.popups=l.popups,n.visibility=!0,t.queryLayers.push(n),t.map.addLayer(n),P(t,y,g,n.id,l.tab),n.visibility=g):"json"===d?(n=new OpenLayers.Layer.Vector(c,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.Script({url:u,params:l.params,format:new OpenLayers.Format.GeoJSON({internalProjection:t.map.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4269"),read:function(e){var a,o,r,n,i,s,p,d,m,c,g,u=l.root,y=e[u]?e[u]:e,b=[],f=l.attributes,L=new OpenLayers.Projection("EPSG:4326"),v=t.map.getProjectionObject();for(o=0,r=y.length;o!==r;o+=1){a=y[o],n=new OpenLayers.Feature.Vector,g=a.geometry.coordinates[0],"Polygon"===a.geometry.type&&5===g.length?(p=U(g[1][0],g[1][1],g[3][0],g[3][1]),d=new OpenLayers.Geometry.LinearRing(p),m=new OpenLayers.Geometry.Polygon(d),c=m.transform(L,v),n.geometry=c):n.geometry=this.parseGeometry(a.geometry),i={};for(s in f)f.hasOwnProperty(s)&&(i[f[s]]=a[s]);n.attributes=i,n.geometry&&b.push(n)}return b}})}),eventListeners:{featuresadded:function(e){A(t,y,e,l.zoom,l.datatable,r.useMapControls),t.overlaysLoading[c]&&B(t)},loadstart:function(){t.overlaysLoading[c]=!0,setTimeout(function(){t.overlaysLoading[c]&&B(t)},m)}},styleMap:j(i[s])}),n.name="overlay_"+s,n.datatable=l.datatable,n.popupsInfo=l.popupsInfo,n.popups=l.popups,n.visibility=!0,t.queryLayers.push(n),t.map.addLayer(n),P(t,y,g,n.id,l.tab),n.visibility=g):"geojson"===d&&(n=new OpenLayers.Layer.Vector(c,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.Script({url:u,params:l.params,format:new OpenLayers.Format.GeoJSON({internalProjection:t.map.getProjectionObject(),externalProjection:new OpenLayers.Projection("EPSG:4269"),read:function(e){var a,o,r,n,i,s,p,d,m,c,g,u=e.features,y=[],b=l.attributes,f=new OpenLayers.Projection("EPSG:4326"),L=t.map.getProjectionObject();for(a=0,o=u.length;a!==o;a+=1){r=u[a],n=new OpenLayers.Feature.Vector,g=r.geometry.coordinates[0],"Polygon"===r.geometry.type&&5===g.length?(p=U(g[1][0],g[1][1],g[3][0],g[3][1]),m=new OpenLayers.Geometry.LinearRing(p),d=new OpenLayers.Geometry.Polygon(m),c=d.transform(f,L),n.geometry=c):n.geometry=this.parseGeometry(r.geometry),i={};for(s in b)b.hasOwnProperty(s)&&(i[b[s]]=r.properties[s]);n.attributes=i,n.geometry&&y.push(n)}return y}})}),eventListeners:{featuresadded:function(e){A(t,y,e,l.zoom,l.datatable,r.useMapControls),t.overlaysLoading[c]&&B(t)},loadstart:function(){t.overlaysLoading[c]=!0,setTimeout(function(){t.overlaysLoading[c]&&B(t)},m)}},styleMap:j(i[s])}),n.name="overlay_"+s,n.datatable=l.datatable,n.popupsInfo=l.popupsInfo,n.popups=l.popups,n.visibility=!0,t.queryLayers.push(n),t.map.addLayer(n),P(t,y,g,n.id,l.tab),n.visibility=g)}))},D=function(a,o,r,n){var i,l,p,d,m,c,g,u,y,b,f,L,v,h,w,O,x,C,G,F,E,T,M,A,B,_,z,R,k="<th>"+s.zoomFeature+"</th>",I="<th>"+s.select+"</th>",N=new OpenLayers.Format.WKT({internalProjection:n,externalProjection:r}),W=/<\/?[^>]+>/gi,V=/\W/g;for(z=o.tables.length-1;-1!==z;z-=1){for(d=t.getElementById(o.tables[z].id),p=e(d),p.wrap("<div class='wb-geomap-table-wrapper'></div>"),l=p.parents(".wb-geomap-table-wrapper"),m=o.tables[z],c=[],u=new OpenLayers.Layer.Vector(p.find("caption").text(),{styleMap:j(m)}),y=d.getElementsByTagName("th"),f=d.getElementsByTagName("tr"),L=f.length,v=o.useMapControls,R=o.tables[z].visible===!1?!1:!0,b=y.length-1;-1!==b;b-=1)c[b]=y[b].innerHTML.replace(W,"");for(g=p.find("thead tr"),m.zoom&&v&&g.append(k),g.prepend(I),L=f.length-1;-1!==L;L-=1){for(h={},w=f[L],O=w.getAttribute("data-type"),C=w.getElementsByTagName("td"),G=C.length-1;-1!==G;G-=1)F=C[G],E=F.getElementsByTagName("script")[0],E&&E.parentNode.removeChild(E),h[c[G]]=F.innerHTML;if(null!==O){if("bbox"===O){for(T=w.getAttribute("data-geometry").split(","),A=U(T[0],T[1],T[2],T[3]),B="",_=A.length-1;-1!==_;_-=1)B+=A[_].x+" "+A[_].y+", ";B=B.slice(0,-2),M="POLYGON (("+B+"))"}else"wkt"===O&&(M=w.getAttribute("data-geometry"));x=N.read(M),w.setAttribute("id",x.id.replace(V,"_")),x.attributes=h,u.addFeatures([x])}}u.id="#"+m.id,u.datatable=m.datatable,u.popupsInfo=m.popupsInfo,u.popups=m.popups,u.name=m.id,a.map.addLayer(u),a.queryLayers.push(u),u.visibility=R,m.tab?P(a,p,R,u.id,m.tab):a.glegend&&S(a,p,R,u.id),i=e("#msg_"+m.id),0===i.length&&l.after("<div id='msg_"+m.id+"'><p>"+s.hiddenLayer+"</p></div>"),R?e("#msg_"+m.id).fadeOut():e("#msg_"+m.id).fadeIn(),R?l.fadeIn():l.fadeOut()}},H=function(e,a){var t,o,r,n,i,l,p,d,m,c,g,u=e.gmap,y=e.map,b=s.mouseposition,L=s.scaleline,O=a.useMapControls,x=a.tables,C=x.length,P=e.queryLayers,S=P.length;for(e.selectControl=new OpenLayers.Control.SelectFeature(e.queryLayers,{onSelect:v,onUnselect:h,clickFeature:w}),y.addControl(e.selectControl),e.selectControl.activate(),m=0;m!==C;m+=1)for(r=x[m],n="#"+r.id,d=r.zoom,c=0;c!==S;c+=1)if(i=P[c],i.id===n)for(l=i.features,p=l.length,g=0;g!==p;g+=1)_(e,l[g],d,O);O&&(a.useMousePosition&&(y.addControl(new OpenLayers.Control.MousePosition),t=y.getControlsByClass("OpenLayers.Control.MousePosition")[0].div,t.setAttribute("aria-label",b),t.setAttribute("title",b)),a.useScaleLine&&(y.addControl(new OpenLayers.Control.ScaleLine),o=y.getControlsByClass("OpenLayers.Control.ScaleLine")[0].div,o.setAttribute("aria-label",L),o.setAttribute("title",L)),y.addControl(new OpenLayers.Control.Navigation({zoomWheelEnabled:!0})),y.addControl(new OpenLayers.Control.KeyboardDefaults),y.getControlsByClass("OpenLayers.Control.KeyboardDefaults")[0].deactivate(),u.attr({tabindex:"0","data-map":e.mapid}),f(e),u.before("<details id='geomap-details-"+e.mapid+"' class='wb-geomap-detail' style='width:"+(u.width()-10)+"px;'><summary>"+s.accessTitle+"</summary><p>"+s.access+"</p></details>")),(e.showAttribNRCan||a.attribution)&&(e.showAttribNRCan?y.baseLayer.attribution="<a href='"+s.attribLink+"'>Â©"+s.attribTitle+"</a>":a.attribution.href?y.baseLayer.attribution="<a href='"+a.attribution.href+"'>"+a.attribution.text+"</a>":y.baseLayer.attribution="<p>"+a.attribution.text+"</p>",y.addControl(new OpenLayers.Control.Attribution)),y.zoomToMaxExtent()},U=function(e,a,t,o){var r,n=parseFloat(e),i=parseFloat(a),s=parseFloat(t),l=parseFloat(o),p=[];if(0===n.length||0===i.length||0===s.length||0===l.length)return!1;for(-180===n&&(n+=.1),180===s&&(s=-5),90===l&&(l-=3),-90===i&&(i=35),r=n;s>r;r+=.5)p.push(new OpenLayers.Geometry.Point(r,i));for(p.push(new OpenLayers.Geometry.Point(s,i)),r=s;r>n;r-=.5)p.push(new OpenLayers.Geometry.Point(r,l));return p.push(new OpenLayers.Geometry.Point(n,l)),p.push(new OpenLayers.Geometry.Point(n,i)),p},q=function(e,a){N(e,a),e.locStyle=new OpenLayers.Style({pointRadius:10,strokeColor:"#ff0000",fillColor:"#333333"}),e.locLayer=new OpenLayers.Layer.Vector("Location Features",{styleMap:new OpenLayers.StyleMap({pointRadius:10,graphicName:"cross",strokeWidth:4,strokeOpacity:.6,strokeColor:"#FF0033",fillColor:"#FF0033",fillOpacity:0})}),e.map.addLayer(e.locLayer);var t=new OpenLayers.Projection("EPSG:4326"),o=e.map.getProjectionObject();e.selectControl=new OpenLayers.Control.SelectFeature,x(e,a.useTab),D(e,a,t,o),V(e,a),H(e,a),a.useGeocoder&&J(e),a.useAOI&&X(e),a.useGeolocation&&Q(e),e.gmap.attr({role:"dialog","aria-label":s.ariaMap})},Z=function(){var e,a,t={};for(a=g.length-1;-1!==a;a-=1)e=g[a],t[e.id]=e;return t},K=function(e){var a,t;for(t=g.length-1;-1!==t;t-=1)if(a=g[t],a.id===e)return a},X=function(a){a.drawControl=new OpenLayers.Control.DrawFeature(a.locLayer,OpenLayers.Handler.RegularPolygon,{handlerOptions:{sides:4,irregular:!0},eventListeners:{featureadded:function(t){var o=new OpenLayers.Projection("EPSG:4326"),r=a.map.getProjectionObject(),n=t.feature.geometry.getBounds(),i=n.transform(r,o);e("#geomap-aoi-extent-"+a.mapid).val(n.toString()),e("#geomap-aoi-extent-lonlat-"+a.mapid).val(i.toString()),e("#geomap-aoi-minx-"+a.mapid).val(i.toArray()[0].toFixed(6)),e("#geomap-aoi-miny-"+a.mapid).val(i.toArray()[1].toFixed(6)),e("#geomap-aoi-maxx-"+a.mapid).val(i.toArray()[2].toFixed(6)),e("#geomap-aoi-maxy-"+a.mapid).val(i.toArray()[3].toFixed(6)),e("#geomap-aoi-btn-draw-"+a.mapid).click()}}}),a.map.addControl(a.drawControl),a.gmap.before("<div class='geomap-aoi panel panel-default'><div id='geomap-aoi-"+a.mapid+"' class='panel-body'></div></div>");var t,o,r,n,i,l,p=e("#geomap-map-"+a.mapid),m=e("#geomap-aoi-"+a.mapid);m.append("<fieldset id='form-aoi-"+a.mapid+"'><legend tabindex='-1'>"+s.aoiInstructions+"</legend><div class='row'><div class='col-md-2'><label for='geomap-aoi-maxy-"+a.mapid+"' class='wb-inv'>"+s.aoiNorth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+s.aoiNorth.charAt(0)+"</span><input type='number' id='geomap-aoi-maxy-"+a.mapid+"' placeholder='90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input></div></div><div class='col-md-2'><label for='geomap-aoi-maxx-"+a.mapid+"' class='wb-inv'>"+s.aoiEast+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+s.aoiEast.charAt(0)+"</span><input type='number' id='geomap-aoi-maxx-"+a.mapid+"' placeholder='180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-2'><label for='geomap-aoi-miny-"+a.mapid+"' class='wb-inv'>"+s.aoiSouth+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+s.aoiSouth.charAt(0)+"</span><input type='number' id='geomap-aoi-miny-"+a.mapid+"' placeholder='-90' class='form-control input-sm' min='-90' max='90' step='0.000001'></input> </div></div><div class='col-md-2'><label for='geomap-aoi-minx-"+a.mapid+"' class='wb-inv'>"+s.aoiWest+"</label><div class='input-group input-group-sm'><span class='input-group-addon'>"+s.aoiWest.charAt(0)+"</span><input type='number' id='geomap-aoi-minx-"+a.mapid+"' placeholder='-180' class='form-control input-sm' min='-180' max='180' step='0.000001'></input> </div></div><div class='col-md-4'><button class='btn btn-default btn-sm' id='geomap-aoi-btn-draw-"+a.mapid+"'>"+s.add+"</button> <button class='btn btn-default btn-sm' id='geomap-aoi-btn-clear-"+a.mapid+"'>"+s.aoiBtnClear+"</button> </div></div><input type='hidden' id='geomap-aoi-extent-"+a.mapid+"'></input><input type='hidden' id='geomap-aoi-extent-lonlat-"+a.mapid+"'></input></fieldset></div><div class='clear'></div>"),a.aoiToggle?(m.parent().hide(),p.append("<button id='geomap-aoi-toggle-mode-draw-"+a.mapid+"' href='#' class='btn btn-sm geomap-geoloc-aoi-btn' title='"+s.aoiBtnDraw+"'><i class='glyphicon glyphicon-edit'></i><span class='wb-inv'> "+s.aoiBtnDraw+"</span></button>")):e("#geomap-aoi-btn-clear-"+a.mapid).after("<button id='geomap-aoi-toggle-mode-draw-"+a.mapid+"' href='#' class='btn btn-sm geomap-geoloc-aoi-btn' title='"+s.aoiBtnDraw+"'><i class='glyphicon glyphicon-edit'></i> "+s.aoiBtnDraw+"</button>"),d.on("click","#geomap-aoi-toggle-mode-draw-"+a.mapid,function(t){t.preventDefault();var o=a.map.getControlsByClass("OpenLayers.Control.DrawFeature")[0],r=o.active,n=e("#geomap-aoi-"+a.mapid);a.aoiToggle&&n.parent().slideToggle(function(){a.map.events.element.offsets=null,a.map.events.clearMouseCache()}),e(this).toggleClass("active"),r||n.find("legend").trigger("setfocus.wb"),r?o.deactivate():o.activate()}),d.on("click","#geomap-aoi-btn-clear-"+a.mapid,function(t){t.preventDefault(),e("#geomap-aoi-extent-"+a.mapid).val(""),e("#geomap-aoi-extent-lonlat-"+a.mapid).val(""),e("#geomap-aoi-minx-"+a.mapid).val("").parent().removeClass("has-error"),e("#geomap-aoi-miny-"+a.mapid).val("").parent().removeClass("has-error"),e("#geomap-aoi-maxx-"+a.mapid).val("").parent().removeClass("has-error"),e("#geomap-aoi-maxy-"+a.mapid).val("").parent().removeClass("has-error"),a.locLayer.removeAllFeatures()}),d.on("click","#geomap-aoi-btn-draw-"+a.mapid,function(t){t.preventDefault(),e("#geomap-aoi-extent-"+a.mapid).val(""),e("#geomap-aoi-extent-lonlat-"+a.mapid).val(""),e("#geomap-aoi-minx-"+a.mapid).parent().removeClass("has-error"),e("#geomap-aoi-maxx-"+a.mapid).parent().removeClass("has-error"),e("#geomap-aoi-maxy-"+a.mapid).parent().removeClass("has-error"),e("#geomap-aoi-miny-"+a.mapid).parent().removeClass("has-error"),a.locLayer.removeAllFeatures();var o,r,n=parseFloat(e("#geomap-aoi-minx-"+a.mapid).val()),i=parseFloat(e("#geomap-aoi-miny-"+a.mapid).val()),s=parseFloat(e("#geomap-aoi-maxx-"+a.mapid).val()),l=parseFloat(e("#geomap-aoi-maxy-"+a.mapid).val()),p=!0;return(!n||-180>n||n>180)&&(e("#geomap-aoi-minx-"+a.mapid).parent().addClass("has-error"),p=!1),(!s||-180>s||s>180)&&(e("#geomap-aoi-maxx-"+a.mapid).parent().addClass("has-error"),p=!1),(!l||-90>l||l>90)&&(e("#geomap-aoi-maxy-"+a.mapid).parent().addClass("has-error"),p=!1),(!i||-90>i||i>90)&&(e("#geomap-aoi-miny-"+a.mapid).parent().addClass("has-error"),p=!1),p===!1?!1:(r={minx:n,miny:i,maxx:s,maxy:l},o=Y(a,r),a.map.zoomToExtent(a.locLayer.getDataExtent()),e("#geomap-aoi-extent-"+a.mapid).val(o.getBounds().toBBOX()).trigger("change"),void e("#geomap-aoi-extent-lonlat-"+a.mapid).val(n+", "+i+", "+s+", "+l).trigger("change"))}),a.aoiExtent&&(t=a.aoiExtent.split(","),o=t[0].trim(),r=t[1].trim(),
n=t[2].trim(),i=t[3].trim(),l=Y(a,{minx:o,miny:r,maxx:n,maxy:i}),a.map.zoomToExtent(a.locLayer.getDataExtent()),e("#geomap-aoi-minx-"+a.mapid).val(o),e("#geomap-aoi-maxx-"+a.mapid).val(n),e("#geomap-aoi-maxy-"+a.mapid).val(i),e("#geomap-aoi-miny-"+a.mapid).val(r),e("#geomap-aoi-extent-"+a.mapid).val(l.getBounds().toBBOX()),e("#geomap-aoi-extent-lonlat-"+a.mapid).val(o+", "+r+", "+n+", "+i))},Y=function(e,a){var t,o,r,n,i,s,l;return t=U(a.minx,a.miny,a.maxx,a.maxy),o=new OpenLayers.Geometry.LinearRing(t),r=new OpenLayers.Geometry.Polygon(o),n=new OpenLayers.Projection("EPSG:4326"),i=e.map.getProjectionObject(),s=r.transform(n,i),l=new OpenLayers.Feature.Vector(s),e.locLayer.addFeatures([l]),s},J=function(a){var t,o,r=e("#geomap-map-"+a.mapid);r.append("<div class='geomap-geoloc'><label for='wb-geomap-geocode-search-"+a.mapid+"' class='wb-inv'>"+s.geoCoderLabel+"</label><input type='text' class='form-control input-sm opct-90' name='wb-geomap-geocode-search-"+a.mapid+"' id='wb-geomap-geocode-search-"+a.mapid+"' list='wb-geomap-geocode-results-"+a.mapid+"' autocomplete='off' placeholder='"+s.geoCoderPlaceholder+"' /><datalist id='wb-geomap-geocode-results-"+a.mapid+"'></datalist></div>"),e("#wb-geomap-geocode-search-"+a.mapid).trigger("wb-init.wb-datalist"),d.on("keypress","#wb-geomap-geocode-search-"+a.mapid,function(t){if(13===t.keyCode){var o,r,n,i,s,l,p,d,m,c,g,u,y,b=new OpenLayers.Projection("EPSG:4326"),f=a.map.getProjectionObject();if(a.locLayer.destroyFeatures(),u=e("#wb-geomap-geocode-search-"+a.mapid).val(),!u)return e("#wb-geomap-geocode-search-"+a.mapid).parent().addClass("has-error"),void setTimeout(function(){e("#wb-geomap-geocode-search-"+a.mapid).parent().removeClass("has-error")},5e3);o=e("#wb-geomap-geocode-results-"+a.mapid+" option").filter(function(){return this.value===u}).data("bbox"),m=e("#wb-geomap-geocode-results-"+a.mapid+" option").filter(function(){return this.value===u}).data("lat-lon"),n={bbox:o,lonlat:m},null!=n.bbox?(r=new OpenLayers.Bounds.fromString(n.bbox),i=U(r.left,r.bottom,r.right,r.top),g=new OpenLayers.Geometry.LinearRing(i),l=new OpenLayers.Geometry.Polygon(g),p=l.transform(b,f),s=new OpenLayers.Feature.Vector(p),a.locLayer.addFeatures([s]),a.map.zoomToExtent(p.getBounds())):null!=n.lonlat&&(y=0===a.map.getZoom()?.85*a.map.numZoomLevels:a.map.getZoom(),d=new OpenLayers.LonLat(n.lonlat.split(",")).transform(b,f),c=new OpenLayers.Geometry.Point(d.lon,d.lat),s=new OpenLayers.Feature.Vector(c),a.locLayer.addFeatures([s]),a.map.setCenter(d,y))}}),d.on("keyup","#wb-geomap-geocode-search-"+a.mapid,function(r){var n,i,l,p,d,m=e("<datalist id='wb-geomap-geocode-results-"+a.mapid+"'></datalist>"),c=[];e(this).parent().removeClass("has-error"),n=e(this).val().trim(),d=r.which,""===n||n.length<=2||13===d||(t&&t.abort(),clearTimeout(o),o=setTimeout(function(){t=e.get(s.geoLocationURL,{q:n+"*"},function(t){if(c=["<!--[if lte IE 9]><select><![endif]-->"],t.length)for(var o=0,r=t.length;r>o;o++)p=t[o].title.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;"),i=t[o].bbox?t[o].bbox[0]+", "+t[o].bbox[1]+", "+t[o].bbox[2]+", "+t[o].bbox[3]:null,l=t[o].geometry&&"Point"===t[o].geometry.type?t[o].geometry.coordinates[0]+", "+t[o].geometry.coordinates[1]:null,c.push("<option value='"+p+"' data-lat-lon='"+l+"' data-bbox='"+i+"' data-type='"+t[o].type+"'></option>"),o===r-1&&(c.push("<!--[if lte IE 9]></select><![endif]-->"),m.html(c));e("#wb-geomap-geocode-search-"+a.mapid).removeClass("wb-datalist-inited"),e("#wb-geomap-geocode-results-"+a.mapid).remove(),e("#wb-al-wb-geomap-geocode-search-"+a.mapid).remove(),e("#wb-al-wb-geomap-geocode-search-"+a.mapid+"-src").remove(),e("#wb-geomap-geocode-search-"+a.mapid).after(m),e("#wb-geomap-geocode-search-"+a.mapid).trigger("wb-init.wb-datalist")},"jsonp")},500))})},Q=function(a){e("body").append("<section id='overlay-location-error' class='wb-overlay modal-content overlay-def wb-bar-t bg-danger'><header><h2 class='modal-title'>Geolocation error.</h2></header></section>"),e("#overlay-location-error").trigger("wb-init.wb-overlay");var o=new OpenLayers.Control.Button({title:s.geolocBtn,displayClass:"olButtonGeolocate",eventListeners:{activate:function(){a.geoLocLayer.removeAllFeatures(),a.geolocate.deactivate(),a.geolocate.watch=!0,a.geolocate.activate()},deactivate:function(){a.geoLocLayer.removeAllFeatures(),a.geolocate.deactivate(),a.geolocate.watch=!1}},type:OpenLayers.Control.TYPE_TOGGLE}),r=new OpenLayers.Control.Panel({displayClass:"olPanelGeolocate",createControlMarkup:function(){return t.createElement("button")}});r.addControls([o]),a.geoLocLayer=new OpenLayers.Layer.Vector("geoLocLayer"),a.geolocate=new OpenLayers.Control.Geolocate({type:OpenLayers.Control.TYPE_TOGGLE,bind:!0,watch:!0,geolocationOptions:{enableHighAccuracy:!0,maximumAge:0,timeout:7e3},eventListeners:{locationupdated:function(e){a.geoLocLayer.removeAllFeatures();var t=new OpenLayers.Feature.Vector(e.point,null,{graphicName:"circle",fillColor:"#FF0033",strokeWidth:0,pointRadius:5}),o=new OpenLayers.Feature.Vector(OpenLayers.Geometry.Polygon.createRegularPolygon(new OpenLayers.Geometry.Point(e.point.x,e.point.y),e.position.coords.accuracy/2,40,0),null,{fillOpacity:.3,fillColor:"#FF0033",strokeWidth:0});a.geoLocLayer.addFeatures([t,o]),a.map.zoomToExtent(a.geoLocLayer.getDataExtent()),$(o,a.geoLocLayer)},locationuncapable:function(){e("#overlay-location-error h2.modal-title").text(s.geolocUncapable),e("#overlay-location-error").trigger("open.wb-overlay")},locationfailed:function(){e("#overlay-location-error h2.modal-title").text(s.geolocFailed),e("#overlay-location-error").trigger("open.wb-overlay")}}}),a.map.addLayers([a.geoLocLayer]),a.map.addControls([r,a.geolocate])},$=function(e,t){var o=e.geometry.getCentroid(),r=e.geometry.getBounds(),n=Math.abs((r.right-r.left)/2),i=0,s="up",l=function(){i>16&&clearInterval(a.resizeInterval);var r=.03*n,l=r/n;switch(i){case 4:case 12:s="down";break;case 8:s="up"}"up"!==s&&(l=-Math.abs(l)),e.geometry.resize(1+l,o),t.drawFeature(e),i++};a.resizeInterval=a.setInterval(l,50,o,n)},ee=function(a){var t,r,n=a.glayers,i=a.map,s=i.layers;n.find(".wb-tables").trigger("wb-init.wb-tables"),n.find(".wb-geomap-tabs").trigger("wb-init.wb-tabs"),G(a),a.map.id=a.mapid,g.push(i),setTimeout(function(){a.gmap.find("img").attr("alt",""),e(".olTileImage").attr("alt",""),o.ready(e("#"+a.mapid),l,[i])},2e3),a.map.events.on({moveend:function(){for(e(".olTileImage").attr("alt",""),e(a.mapid).trigger("wb-updated"+p,[i]),r=s.length-1;-1!==r;r-=1)t=s[r],"OpenLayers.Layer.WMS"===t.CLASS_NAME&&t.redraw(!0)}}),g.length===e(p).length&&o.doc.trigger("geomap.ready",[Z()])},ae=function(e){var a,t=K(e.getAttribute("data-map"));return e.getAttribute("data-layer")?(a=t.getLayer(e.getAttribute("data-layer")),[t,a,"OpenLayers.Layer.Vector"===a.CLASS_NAME?a.getFeatureById(e.getAttribute("data-feature")):null]):[t,null,null]};d.on("geomap.wb",p,y),d.on("click",".geomap-zoomto",function(a){var t,o,r=a.which,n=a.target;r&&1!==r||(a.preventDefault(),t=n.getAttribute("data-map"),o=ae(n),o[0].zoomToExtent(o[2].geometry.bounds),e("#"+t+" .wb-geomap-map").trigger("setfocus.wb"))}),d.on(o.resizeEvents,function(){if(0!==g.length){var a,t,o,r=Z();for(a in r)r.hasOwnProperty(a)&&(t=r[a],o=e(t.div),o.height(.8*o.width()),t.updateSize(),t.zoomToMaxExtent())}}),d.on("change",".geomap-cbx",function(e){var a=e.target,t=ae(a)[2];a.checked?w(t):n.selectControl.unselect(t)}),d.on("change",".geomap-lgnd-cbx",function(a){var o=a.target,r=ae(o)[1],n=o.value,i=t.getElementById("cb_"+n).checked,l=e("table#"+n),p=l.parents(".wb-geomap-table-wrapper"),d=e("#msg_"+n);r.setVisibility(i),e("#sb_"+r.name).toggle(i),0!==d.length?i?d.fadeOut():d.fadeIn():p.after("<div id='msg_"+n+"'><p>"+s.hiddenLayer+"</p></div>"),i?p.fadeIn():p.fadeOut()}),d.on("mouseenter mouseleave focusin focusout",".wb-geomap-map",function(a){var t,o=a.type,r=a.currentTarget,n=K(r.getAttribute("data-map")),i="OpenLayers.Control.KeyboardDefaults",s="OpenLayers.Control.Navigation";n&&(t=r.className.indexOf("active"),"mouseenter"===o||"focusin"===o?t&&(n.getControlsByClass(i)[0].activate(),n.getControlsByClass(s)[0].activate(),e(r).addClass("active")):t||(n.getControlsByClass(s)[0].deactivate(),n.getControlsByClass(i)[0].deactivate(),e(r).removeClass("active")))}),d.on("keydown click",".olPopupCloseBox span",function(e){var a=e.which,t=e.currentTarget;"keydown"===e.type?13===a&&ae(t)[2].popup.hide():a&&1!==a||K(t.getAttribute("data-map")).getControlsByClass("OpenLayers.Control.SelectFeature")[0].unselect(r)})}(jQuery,window,document,wb);